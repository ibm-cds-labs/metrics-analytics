# Simple Metrics Tutorial

This project is a companion to the [metrics-collector](https://github.com/ibm-cds-labs/metrics-collector) project which is a simple service for capturing user interaction events and storing them in a Cloudant database.

Metrics Analytics is a *couchapp* application that provides simple but powerful visualizations on the user data collected by the metrics-collector application. It is implemented using [d3](http://d3js.org/), [angular](https://angularjs.org) and [bootstrap](http://getbootstrap.com/).

> **Note: By using these 2 projects, you can easily instrument your application to track how your users use it and get powerful reports on the data**

## Overview 

1. On the left-hand side of the screen, click on a report.	
   * By Total Events
   * By Search Category
   * By Platform
   * By Browser  
   * Top 10 searches
  
1. Use the date picker to select a date range for your query  
	* Today
	* Yesterday
	* Last 7 days
	* Last 30 days
	* This Month
	* Last Month
	* Custom range

1. Use the button bar to select the type of visualization for the data:  
	* Bar Chart  
	* Pie Chart 
	* Table 

1. Select the application for which you want to view reports. As described in [Part 1](https://github.com/ibm-cds-labs/metrics-collector/tutorial/tutorial.md), applications are identified by a unique id which is included in the tracking script tag. e.g:  

   ```html
<script src="http://metrics-collector.domainname/tracker.js" siteid="my.app.id"></script>
```

These charts are built off the data generated by metrics collection in Part 1 of the tutorial. In Part 2, we use MapReduce in Cloudant/CouchDB to build different views of the data. Each of those views are what shows up here as reports. We pull in the view and pass the data to [D3](http://d3js.org), which renders the data into [SVG](https://en.wikipedia.org/wiki/Scalable_Vector_Graphics) in the browser. While we don't get into details here, the user interface is built with [Bootstrap](http://getbootstrap.com) and [AngularJS](http://angularjs.org) to produce a pleasant user experience. 

This tutorial will give you an understanding of how to build MapReduce views in Cloudant/CouchDB and wire them to [D3](http://d3js.org) for visualization.


   > Note for developers: if you don't find a built-in query that fits your needs, it is very simple to add your own by editing the js/app.js file:
	
   ```javascript  
//Add JSON object to the following table:
// Name: name of the query that will appear in the combo box
// view: name of the supporting couch view that will be used to access the data
// builder: function that returns a builder object. See app/_attachments/charts/chartTotalEvents.js for example
$scope.visualizations=[
	    {name:"By Events - total", view: "grouped_events", builder: getTotalEventsChartBuilder() },
	    {name:"By Search Category", view: "search_by_categories", builder: getTotalEventsChartBuilder() },
	    {name:"My very own query", view: "supporting_custom_view", builder: getMyCustomQueryBuilder() }
	];
   ```  

## A word about CouchApps
CouchApps are web applications which can be served directly from [CouchDB](http://couchdb.apache.org). This gives them the nice property of replicating just like any other data stored in CouchDB. They are also simple to write as they can use the built-in jQuery libraries and plugins that ship with CouchDB.

[More info about CouchApps here.](http://couchapp.org)

## Deploying this app

Assuming you just cloned this app from GitHub and you have changed into the app directory in your terminal, you want to push it to your CouchDB/Cloudant with the CouchApp command line tool, like this:

    couchapp push . http://name:password@hostname:port/mydatabase

If you don't have a password on your CouchDB/Cloundant (admin party) you can do it like this (but it's a bad idea -- set a password):

    couchapp push . http://hostname:5984/mydatabase

If you get sick of typing the URL, you should setup a `.couchapprc` file in the root of your directory. Remember not to check this into version control as it will have passwords in it.

The `.couchapprc` file should have contents like this:

```json
{
  "env" : {
    "public" : {
      "db" : "http://name:pass@mycouch.couchone.com/mydatabase"
    },
    "default" : {
      "db" : "http://name:pass@localhost:5984/mydatabase"
    }
  }
}
```

Now that you have the `.couchapprc` file set up, you can push your app to the CouchDB as simply as:

    couchapp push

This pushes to the `default` as specified. To push to the `public` you'd run:

    couchapp push public

Of course you can continue to add more deployment targets as you see fit, and give them whatever names you like.


